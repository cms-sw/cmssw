#include "L1Ntuple.h"
#include "hist.C"
#include "Style.C"

#include <TROOT.h>
#include <TChain.h>
#include <TFile.h>
#include <TTree.h>
#include <TFriendElement.h>
#include <TList.h>
//#include <TGraph.h>
#include <TGraphAsymmErrors.h>
#include <TLine.h>
#include <stdio.h>
#include <math.h>
#include <iostream>
#include <fstream>

#include "TInterpreter.h"
#include "modifiedStyle.C"
#include "TColor.h"
#include "TF1.h"
#include "TMath.h"
//#include "ufLumiObject.cc"
#include "./CSCTFPtMethods.cc"

using namespace std;

Double_t fitPT(Double_t*, Double_t*);
Double_t A0 = 0.9; //defined platau at fitPT, it should be recalculated in the code
double Pi  = acos(-1.);
float PtCut = 0.;  // cut for pt of global muon
//float PtCut = 10.;  // cut for pt of global muon
// Create Binning:
  //for 2010 and 2011
  const float PTbin[] = {2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0, 6.0, 7.0, 8.0,
  9.0, 10.0, 12.0, 14.0, 16.0, 18.0, 20.0, 25.0, 30.0, 40.0, 50.0, 80.0, 140.0};
  // for 2012
  //const float PTbin[] = {2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0, 6.0, 7.0, 8.0,
  // 9.0, 10.0, 12.0, 14.0, 20.0, 30.0, 100.0};
  //const float PTbin_high[] = {2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0, 6.0, 7.0, 8.0,
  // 9.0, 10.0, 20.0, 140.0};
  const float PTbin_high[] = {2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0, 6.0, 7.0, 8.0,
   9.0, 10.0, 14.0, 20.0, 50., 140.0};
  const float ETAbin[] = {0.9, 1.0, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6,
   1.7, 1.8, 1.9, 2.0, 2.1, 2.2, 2.3, 2.4 };
  //cout << "size of PTbin" << endl;
  //cout << "size of PTbin = " << sizeof(PTbin)/sizeof(float) << endl;
  //cout << "size of ETAbin = " << sizeof(ETAbin)/sizeof(float) << endl;

   const int PTMETHOD = 2011; // or any -> use current pt assigmnent like in emulator
   //const int PTMETHOD = 2010; // use PT assigment lin in 2010 PT_METHOD = 4 
   const int NPThist = (sizeof(PTbin)/sizeof(float)-1);
   const int NPThist_high = (sizeof(PTbin_high)/sizeof(float)-1);
   const int NETAhist = (sizeof(ETAbin)/sizeof(float)-1);
   //cout << "NPTbin = " << NPThist << endl;
   //cout << "NETAbin = " << NETAhist << endl;
   const int Nhist = NPThist*NETAhist;

   // PRELIM 2010   
   //const float cutHLT[] = {5., 7., 9., 11.}; 
   //const int N_thr = sizeof(cutHLT)/sizeof(float);
   //const float cutL1[] = {3., 5., 7., 9.}; // P5 L1 
   //const float cutL150[] = {2.3, 3.9, 6.1, 8.2}; // P5 L1 

   // 2011 test
   //const float cutHLT[] = {5., 7., 10.};
   const float cutHLT[] = {7., 10., 12.};
   //const float cutHLT[] = {20., 20., 20.};
   const int N_thr = sizeof(cutHLT)/sizeof(float);
   //const float cutL1[] = {3., 5., 7.}; // P5 L1 
   const float cutL1[] = {5., 7., 10.}; // P5 L1 
   //const float cutL1[] = {10., 12., 14.}; // P5 L1 
   //const float cutL150[] = { 4., 6., 9.}; // P5 L1
   //const float cutL1[] = {3.,5., 14., 20.}; // P5 L1 
   //const float cutL150[] = {2.3, 4., 12., 16.}; // P5 L1

   //const float cutL1[] = {3., 4., 6., 8.};  // pr: propousal
   const int Ncolor[] = {4, 2, 28, 8};
   const int Nstyle[] = {21, 22, 20, 23};
   
   const float cutPT[] = {3., 5., 7., 14., 20., 30.};
   const int N_cutPT = sizeof(cutPT)/sizeof(float);

   float CSCTFres;
   float CSCTFres12;
   float CSCTFres23;
// --------------------------------------------------------------------
//                       L1CSCTF_tightRES_GOLDEN_PREL2011 macro definition
// 
//    macro automatically generated by GenerateMacro.sh script 
//    author           : kropiv
//    creation date    : Wed May 26 15:06:16 CEST 2010 
//    last update date : 
//    description      : 
//
// --------------------------------------------------------------------

class L1CSCTF_tightRES_GOLDEN_PREL2011 : public L1Ntuple
{
  public :

    //constructor    
    L1CSCTF_tightRES_GOLDEN_PREL2011() {}
    L1CSCTF_tightRES_GOLDEN_PREL2011(std::string filename) : L1Ntuple(filename) {}

    //main function macro : arguments can be adpated to your need
    void run(Long64_t nevents);
    void bookhistos();     // to book histograms
    // my code here:

    void printhistos();     // to draw and print histogram images

    void fillEffPt(TGraphAsymmErrors* histo[], TLine* line[], TString, TString, TString, TString, int);
    void fillEffEta(TGraphAsymmErrors* histo[], TString, TString, TString, TString);
   //end my code
  private : 

    //your private methods can be declared here
  TH1F* hDeltaR_matching;
  TH1F* hDeltaPhi_matching;
  TH1F* hDeltaEta_matching;

  TH1F* hModeHQptRecoLt2etaGt2p1;
  TH1F* hModeHQptRecoLt2nomode5etaGt2p1;
  TH1F* hModeHQptRecoLt5etaGt2p1;
  TH1F* hModeHQptRecoLt5nomode5etaGt2p1;
  TH1F* hModeHQptRecoGt10etaGt2p1;
  TH1F* hModeHQptRecoGt10nomode5etaGt2p1;


  ////// overlap region ///////////
  //pt efficiency
  TH1F* hcsctfPt_DT_All;
  TH1F* hcsctfPt_DT_HLT[N_thr];
  //eta efficiency
  TH1F* hcsctfEta_DT_AllHLT[N_thr];
  TH1F* hcsctfEta_DT_HLT[N_thr];
  //Phi efficiency
  TH1F* hcsctfPhi_DT_AllHLT[N_thr];
  TH1F* hcsctfPhi_DT_HLT[N_thr];
////// golden region ///////////
  //pt efficiency
  TH1F* hcsctfPt_Q2Q3_All;
  TH1F* hcsctfPt_Q2Q3_HLT[N_thr];
  TH1F* hcsctfPt_Q1_All;
  TH1F* hcsctfPt_Q1_HLT[N_thr];
  TH1F* hcsctfPt_Q2_All;
  TH1F* hcsctfPt_Q2_HLT[N_thr];
  TH1F* hcsctfPt_Q3_All;
  TH1F* hcsctfPt_Q3_HLT[N_thr];
  //eta efficiency
  TH1F* hcsctfEta_Q2Q3_AllHLT[N_thr];
  TH1F* hcsctfEta_Q2Q3_HLT[N_thr];
  TH1F* hcsctfEta_Q1_AllHLT[N_thr];
  TH1F* hcsctfEta_Q1_HLT[N_thr];
  TH1F* hcsctfEta_Q2_AllHLT[N_thr];
  TH1F* hcsctfEta_Q2_HLT[N_thr];
  TH1F* hcsctfEta_Q3_AllHLT[N_thr];
  TH1F* hcsctfEta_Q3_HLT[N_thr];
  //Phi efficiency
  TH1F* hcsctfPhi_Q2Q3_AllHLT[N_thr];
  TH1F* hcsctfPhi_Q2Q3_HLT[N_thr];
  TH1F* hcsctfPhi_Q1_AllHLT[N_thr];
  TH1F* hcsctfPhi_Q1_HLT[N_thr];
  TH1F* hcsctfPhi_Q2_AllHLT[N_thr];
  TH1F* hcsctfPhi_Q2_HLT[N_thr];
  TH1F* hcsctfPhi_Q3_AllHLT[N_thr];
  TH1F* hcsctfPhi_Q3_HLT[N_thr];
////// golden region: mode 5 ///////////
  //pt efficiency
  TH1F* hcsctfPt_mode5_All;
  TH1F* hcsctfPt_mode5_HLT[N_thr];
  //eta efficiency
  TH1F* hcsctfEta_mode5_AllHLT[N_thr];
  TH1F* hcsctfEta_mode5_HLT[N_thr];
  //Phi efficiency
  TH1F* hcsctfPhi_mode5_AllHLT[N_thr];
  TH1F* hcsctfPhi_mode5_HLT[N_thr];
////// golden region: Quality 1 and no mode 5 ///////////
  //pt efficiency
  TH1F* hcsctfPt_Q1nomode5_All;
  TH1F* hcsctfPt_Q1nomode5_HLT[N_thr];
  //eta efficiency
  TH1F* hcsctfEta_Q1nomode5_AllHLT[N_thr];
  TH1F* hcsctfEta_Q1nomode5_HLT[N_thr];
  //Phi efficiency
  TH1F* hcsctfPhi_Q1nomode5_AllHLT[N_thr];
  TH1F* hcsctfPhi_Q1nomode5_HLT[N_thr];


////// high eta region ///////////
  //pt efficiency
  TH1F* hcsctfPt_Q3high_All;
  TH1F* hcsctfPt_Q3high_HLT[N_thr];
  //eta efficiency
  TH1F* hcsctfEta_Q3high_AllHLT[N_thr];
  TH1F* hcsctfEta_Q3high_HLT[N_thr];
  //Phi efficiency
  TH1F* hcsctfPhi_Q3high_AllHLT[N_thr];
  TH1F* hcsctfPhi_Q3high_HLT[N_thr];

  TH1F* hcsctfPt_Q2high_All;
  TH1F* hcsctfPt_Q2high_HLT[N_thr];
  //eta efficiency
  TH1F* hcsctfEta_Q2high_AllHLT[N_thr];
  TH1F* hcsctfEta_Q2high_HLT[N_thr];
  //Phi efficiency
  TH1F* hcsctfPhi_Q2high_AllHLT[N_thr];
  TH1F* hcsctfPhi_Q2high_HLT[N_thr];


  //pt efficiency
  TH1F* hcsctfPt_mode5high_All;
  TH1F* hcsctfPt_mode5high_HLT[N_thr];
  //eta efficiency
  TH1F* hcsctfEta_mode5high_AllHLT[N_thr];
  TH1F* hcsctfEta_mode5high_HLT[N_thr];
  //Phi efficiency
  TH1F* hcsctfPhi_mode5high_AllHLT[N_thr];
  TH1F* hcsctfPhi_mode5high_HLT[N_thr];

  //pt efficiency
  TH1F* hcsctfPt_Q1nomode5high_All;
  TH1F* hcsctfPt_Q1nomode5high_HLT[N_thr];
  //eta efficiency
  TH1F* hcsctfEta_Q1nomode5high_AllHLT[N_thr];
  TH1F* hcsctfEta_Q1nomode5high_HLT[N_thr];
  //Phi efficiency
  TH1F* hcsctfPhi_Q1nomode5high_AllHLT[N_thr];
  TH1F* hcsctfPhi_Q1nomode5high_HLT[N_thr];

////// high eta region mode 8: ME2-ME3  ///////////
  //pt efficiency
  TH1F* hcsctfPt_mode8high_All;
  TH1F* hcsctfPt_mode8high_HLT[N_thr];
  //eta efficiency
  TH1F* hcsctfEta_mode8high_AllHLT[N_thr];
  TH1F* hcsctfEta_mode8high_HLT[N_thr];
  //Phi efficiency
  TH1F* hcsctfPhi_mode8high_AllHLT[N_thr];
  TH1F* hcsctfPhi_mode8high_HLT[N_thr];


/// check overlap high pt > 80 GeV inefficiency

  TH1F* hoverlap_pthigh_dphi12;
  TH1F* hoverlap_pthigh_phiBend;

/// check golden high pt ineficiency between 20-60 GeV 

  TH1F* hgoldenQ3_pthigh_dphi12; 
  TH1F* hgoldenQ3_pthigh_dphi23; 
  TH1F* hgoldenQ2_pthigh_dphi12; 
  TH1F* hgoldenQ2_pthigh_dphi23; 

// rate
  TH1F* hRate_global_[N_cutPT];
  TH1F* hRate_Q1_[N_cutPT];
  TH1F* hRate_Q2_[N_cutPT];
  TH1F* hRate_Q3_[N_cutPT];

};


// --------------------------------------------------------------------
//                             run function 
// --------------------------------------------------------------------
void L1CSCTF_tightRES_GOLDEN_PREL2011::run(Long64_t nevents)
{
  //load TDR style
  //setTDRStyle();
/*
//      printf("z1: gROOT Reset \n");
//        gROOT->Reset();
//        gROOT->SetStyle("Plain");
        gStyle->Reset();
        gStyle->SetTitleFont(42);           // title font
        gStyle->SetTitleFontSize(0.07);     // title font size
        gStyle->SetLabelSize(0.05,"xy");     //
        gStyle->SetStatFontSize(0.07);     //for box size
        //gStyle -> SetOptTitle(kFALSE);
        //gStyle -> SetTitleColor(kRed);
        //gStyle->SetStatX(0.97);     // for box x position
        //gStyle->SetStatW(0.25);     // for box width
        //gStyle->SetOptFit(1111); // pcev
        //gStyle->SetPalette(1);
        //gStyle -> SetOptStat(0); // no statistics 
        gStyle->SetTitleOffset(1.2,"xy");
        //gStyle->SetTitleOffset(1.5,"x");
        gStyle->SetTitleSize(0.05,"xyz"); // axis titles
        //gStyle->SetTitleSize(0.05,"h"); // histogram title
        gStyle->SetOptTitle(0);             // title on/off
        gStyle->SetLineWidth(1.5);
        gStyle->SetFillColor(0);
        gStyle->SetFrameFillStyle(0);
  gStyle->SetCanvasColor(kWhite);     // background is no longer mouse-dropping white
  gStyle->SetPalette(1,0);            // blue to red false color palette. Use 9 for b/w
  gStyle->SetCanvasBorderMode(0);     // turn off canvas borders
  gStyle->SetPadBorderMode(0);
//---=[ Pad style ]=----------------
        Float_t LeftOffset = 0.15;
        Float_t TopOffset = 0.15;
        gStyle->SetPadTopMargin(TopOffset);
        gStyle->SetPadBottomMargin(LeftOffset);
        gStyle->SetPadRightMargin(TopOffset);
        gStyle->SetPadLeftMargin(LeftOffset);

// Force this style on all histograms
        gROOT->ForceStyle();
*/

  // output file
  TFile *theFile    =new TFile("L1CSCTF_tightRES_GOLDEN_PREL2011.root", "RECREATE");
  theFile->cd();
// ------------------------------------------------------------------------------
// variables
// ------------------------------------------------------------------------------



  //number of events to process
  if (nevents==-1 || nevents>GetEntries()) nevents=GetEntries();
  std::cout << nevents << " to process ..." << std::endl;


  bookhistos();
  CSCTFPtMethods ptMethods;
   // CSCTF reduce:  for 2 station method A(11,0) - no reduce, use 12 bits
   // CSCTF reduce:  for 3 station method A(8,1), B(7,4) - reduce
   CSCTFres = 62/pow(2, (12-0))*Pi/180;//CSCTF resolution in rad–
   CSCTFres12 = 62/pow(2, (12-1))*Pi/180;//CSCTF resolution in rad–
   CSCTFres23 = 62/pow(2, (12-4))*Pi/180;//CSCTF resolution in rad–

  //loop over the events
  for (Long64_t i=0; i<nevents; i++)
    {
      //load the i-th event 
      Long64_t ientry = LoadTree(i); if (ientry < 0) break;
      GetEntry(i);

      //process progress
      if(i!=0 && (i%10000)==0) 
	std::cout << "- processing event " << i << "\r" << std::flush;

    //std::cout << "N_thr = " << N_thr << std::endl;//check size of PT HLT cuts

    if(recoMuon_->nMuons > 0)
      {
        for (int iMuon = 0; iMuon < recoMuon_->nMuons; iMuon++)
          {//start cycle by reco muon
             if(recoMuon_->type[iMuon] != 0)continue; // select only globul muons
             //select coresponding csc track
             int Ncsctf_cand = 0; // number of the csctf candidate should <= 1   
             int iCSC_cand = -1; //point to the best csctf candidate
             float dr_cand = 0.1; // eta-phi so-called radius
             //float dr_cand = 0.5; // eta-phi so-called radius
             float deta_cand = 100; // 
             float dphi_cand = 100; // 
             float dr_cut = 0.5; // no other muons in this region
             int Ncsctf_cut = 0; // number of the csctf candidates it cut region should <= 1   
             //select good reconstructed muons
             // "+" isGlobalMuon()
             // "+" normchi2 < 10 (globalTrack()->normalizedChi2() < 10)
             // "+?" sa_validhits > 0 (globalTrack()->hitPattern().numberOfValidMuonHits() > 0)
             // "-" (globalTrack()->numberOfMatchedStations() > 1)
             // "-" (fabs(innerTrack()->dxy(vertex->position())) < 0.2 Or dB() < 0.2 on pat::Muon [3] )
             // "+" tr_validpixhits > 0 (track()->hitPattern().numberOfValidPixelHits() > 0)
             // "+" tr_validhits[iMuon] > 10 (track()->hitPattern().numberOfValidTrackerHits() > 10)
             if(recoMuon_->type[iMuon] != 0)continue; // select only globul muons

             // almost tight selection 
             if(recoMuon_->tr_validhits[iMuon] < 11 || recoMuon_->normchi2[iMuon] >= 10.
                || recoMuon_->numberOfValidMuonHits[iMuon] <= 0 || recoMuon_->tr_validpixhits[iMuon] <= 0
                || recoMuon_-> numberOfMatchedStations[iMuon] <= 1
                || recoMuon_-> tr_d0[iMuon] >= 0.2
                || recoMuon_->tr_pt[iMuon] < PtCut) continue;


             if(csctf_->trSize > 0)
                {
                    for (int iCSC = 0; iCSC < csctf_->trSize ; iCSC++ )
                      {// start cycle by CSCTF
                        float etacsctf = csctf_->trEta[iCSC];
                        //float deta = fabs(recoMuon_->tr_eta[iMuon]) - etacsctf;
                        float deta = fabs(recoMuon_->rchEta[iMuon]) - etacsctf;
                        //float deta = 0; 
                        float phi_csc = csctf_->trPhi_02PI[iCSC];
                        //******* matching to global muon directly, not good one  
                        //if(phi_csc > Pi) phi_csc = phi_csc - 2*Pi; //from [0, 2pi] range to [-pi, pi] one
                        //float dphi = fabs((recoMuon_->tr_phi[iMuon]) - phi_csc);
                        //******* matching to csc hits from global, the best one  
                        float dphi = fabs((recoMuon_->rchPhi[iMuon]) - phi_csc);
                        //float dphi = 0;
                        if(dphi > Pi) dphi = fabs(2*Pi - dphi);
                        //Ncsctf_cand++;
                        //calculate so-called radius of the given candidate
                        float dr = sqrt(deta*deta +dphi*dphi);
                        hDeltaR_matching -> Fill (dr);
                        hDeltaPhi_matching -> Fill (dphi);
                        hDeltaEta_matching -> Fill (deta);
                        //float dr = fabs(deta);
                       // select one best candidate 
                       if(dr < dr_cand) {dr_cand = dr; deta_cand = deta; dphi_cand = dphi; iCSC_cand = iCSC; Ncsctf_cand++;}
                       if(dr < dr_cut) Ncsctf_cut++;
                      }// end cycle by CSCTF
                }
//// no more other reco muons in dr_cut 
            int Ncsctf_recocut = 0; // number of the csctf candidates it cut region should <= 1   
            for (int iMuon2 = 0; iMuon2 < recoMuon_->nMuons; iMuon2++) {
                if(iMuon == iMuon2)continue; // different reco muon
                if(recoMuon_->type[iMuon2] != 0 && recoMuon_->type[iMuon2] != 2)continue; // select only globul and tracker muons
                float deta = recoMuon_->rchEta[iMuon] - recoMuon_->rchEta[iMuon2];
                float dphi = fabs(recoMuon_->rchPhi[iMuon] - recoMuon_->rchPhi[iMuon2]);
                if(dphi > Pi) dphi = fabs(2*Pi - dphi);
                float dr = sqrt(deta*deta +dphi*dphi);
                if(dr < dr_cut) Ncsctf_recocut++;
            }
//// reco track should have CSC/RPC (Q_gmt = 7) matchign:
           float dr_gmtcand = 0.1; // eta-phi so-called radius
           float Qual_gmtcand = 0; // eta-phi so-called radius
           for (int iGMT = 0; iGMT < gmt_->N ; iGMT++ ){// start cycle by GMT
                        float etagmt = gmt_->Eta[iGMT];
                        float deta = recoMuon_->rchEta[iMuon] - etagmt;
                        //float deta = 0; 
                        float phigmt = gmt_->Phi[iGMT];
                        float dphi = fabs(recoMuon_->rchPhi[iMuon] - phigmt);
                        if(dphi > Pi) dphi = fabs(2*Pi - dphi);
                        //calculate so-called radius of the given candidate
                        float dr = sqrt(deta*deta +dphi*dphi);
                       // select one best candidate 
                       if(dr < dr_gmtcand) {dr_gmtcand = dr;Qual_gmtcand = gmt_->Qual[iGMT];}

           }
//                        
            //cout << "****************************** " << endl; 
            //cout << "test PASS, Ncsctf_cand = " << Ncsctf_cand << endl; 
            if(Ncsctf_cand != 1) continue;
            //cout << "test PASS1 " << endl; 
            if(Ncsctf_cut != 1) continue; // one csc muon in dr_cut region 
            //cout << "test PASS2 " << endl; 
            if(Ncsctf_recocut != 0) continue; // no extra reco muon in dr_cut region 
            //cout << "test PASS3 " << endl; 
            //if(Qual_gmtcand != 7) continue; // Should be CSC/RPC track

            if(iCSC_cand > -1)
                {// start CSC cand
                  //select Q2&Q3 and golden eta: 1.2<|eta|<2.1  
//                  if(csctf_->trMode[iCSC_cand] == 14) cout << "Mode = 14, Pt global = " << recoMuon_->tr_pt[iMuon] << " eta global = " << fabs(recoMuon_->tr_eta[iMuon]) << endl; 


                  float phi_global = recoMuon_->tr_phi[iMuon];
                  if(phi_global < 0.) phi_global = 2*Pi + phi_global;
                  float eta_global = fabs(recoMuon_->tr_eta[iMuon]);
                  float pt_global =  recoMuon_->tr_pt[iMuon];
                  int mode = csctf_->trMode[iCSC_cand]; 
                  float pt_csctf = csctf_->trPt[iCSC_cand];
                  float eta_csctf = csctf_->trEta[iCSC_cand];
                  float phi_csctf = csctf_->trPhi_02PI[iCSC_cand];

                  // fill resolution as Quality:
                  int Q_tight = csctf_->trQuality[iCSC_cand];
                  int Q_loose = csctf_->trQuality[iCSC_cand];
                  int Q_medium = csctf_->trQuality[iCSC_cand];
                  if(mode == 8 || mode == 9 || mode == 10) Q_medium = 1;
                  if((mode == 8 || mode == 9 || mode == 10) && fabs(eta_csctf) > 1.6 && fabs(eta_csctf) < 1.8 )Q_loose = 2;
                  if(mode == 5 || mode == 8 || mode == 9 || mode == 10) Q_tight = 1;

                 // defined front rare bit
                  // check front bit for ME1
                  // we are interesting only in ME1 wich are not combined with DT, so it is alwais on the 1st place 
                  int Front = csctf_->trForR[iCSC_cand];
                  int Sign = csctf_->trPhiSign[iCSC_cand];
/*
                  if( mode != 12 && mode !=14 && mode !=11){
                  if(csctf_->trLctStation[iCSC_cand][0] == 1){
                     int CSCid = csctf_->trLctTriggerCSCID[iCSC_cand][0];
                     if (csctf_->trLctSubSector[iCSC_cand][0] == 1)
                          if (CSCid == 2 || CSCid == 4 || CSCid == 6) Front = 1;
                     if (csctf_->trLctSubSector[iCSC_cand][0]  == 2)
                          if (CSCid == 1 || CSCid == 3 || CSCid == 5) Front = 1;
                  }}
*/
                if(PTMETHOD == 2010){
                  // make PT assignment like in 2010 at PT_METHOD = 4:
                  if(mode == 6 || mode == 7  || mode == 13){ // make new PT for 2 station track with ME1 
                       float dphi12 = CSCTFres12*float(csctf_->trPhi12[iCSC_cand]);
                       float etaR = eta_csctf;
                       if(Sign == 1 && etaR > 1.6) etaR = 1.55; // shift for ME1/2 station  
                       if(Sign == 0 && etaR < 1.6) etaR = 1.65; // shift for ME1/1 station 
                       pt_csctf = ptMethods.Pt2Stn2010(int(mode), float(etaR), float(dphi12), Front, int(4));
                  }
                  if(mode == 8 || mode == 9  || mode == 10){ // make new PT for 2 station track without ME1 
                       float dphi12 = CSCTFres*float(csctf_->trPhi12[iCSC_cand]);
                       pt_csctf = ptMethods.Pt2Stn2010(int(mode), float(eta_csctf), float(dphi12), Front, int(4));
                  }
                  if(mode == 2 || mode == 3 || mode == 4 || mode == 5){ // new PT for 3 station tracks, no 3 link at high eta 
                       float dphi12 = CSCTFres12*float(csctf_->trPhi12[iCSC_cand]);
                       float dphi23 = CSCTFres23*float(csctf_->trPhi23[iCSC_cand]);
                       if(Sign < 1) dphi23 = -dphi23; 
                       pt_csctf = ptMethods.Pt3Stn2010(int(mode), float(eta_csctf), float(dphi12), float(dphi23), Front, int(4));
                  } 
                  if(mode == 11 || mode == 12 || mode == 14){ // make new PT for overlap
                       int mode_sel = mode;
                       if(mode == 11 && Front == 1) mode_sel = 14;// DT-1-3 -> DT-1  
                       float dphi12 = CSCTFres12*float(csctf_->trPhi12[iCSC_cand]);
		       // take pt_method = 11 only to make correct pt assignment for mode 14
                       // in principle in pt_method = 4 we have only mode 12: DT-2 but I make extantion   
                       pt_csctf = ptMethods.Pt2Stn2010(int(mode_sel), float(eta_csctf), float(dphi12), Front, int(11));
                       //int phiBend = csctf_->trPhi23[iCSC_cand];
                  } 
                  // end new PT_assignment 
                }
                  // overlap region
                  if(  (Q_tight == 3 ) && 
                       (mode == 12 || mode == 14 || mode == 11)  )
                    {
                        hcsctfPt_DT_All -> Fill(pt_global);// fill global pt if we have csctf candidate 
                        for(int ihist = 0; ihist < N_thr; ihist++){ 
                           if(pt_csctf >= cutL1[ihist]){
                              hcsctfPt_DT_HLT[ihist] -> Fill(pt_global);
                              if(pt_global >= cutHLT[ihist])hcsctfEta_DT_HLT[ihist] -> Fill(eta_csctf); 
                              if(pt_global >= cutHLT[ihist])hcsctfPhi_DT_HLT[ihist] -> Fill(phi_csctf); 
                           }
                           if(pt_global >= cutHLT[ihist])hcsctfEta_DT_AllHLT[ihist] -> Fill(eta_csctf);
                           if(pt_global >= cutHLT[ihist])hcsctfPhi_DT_AllHLT[ihist] -> Fill(phi_csctf);
                        }
                     if(pt_global > 80 && pt_csctf < 5){
                        hoverlap_pthigh_dphi12 -> Fill(CSCTFres12*float(csctf_->trPhi12[iCSC_cand])); 
                        int phiBend = csctf_->trPhi23[iCSC_cand];
                        if(csctf_->trPhiSign[iCSC_cand]) phiBend = -phiBend;   
                        hoverlap_pthigh_phiBend -> Fill(phiBend);   
                     }
                    }
                  // end: overlap region

                  // golden region
                  if(  (Q_tight == 2 || Q_tight == 3 ) && 
                       csctf_->trEta[iCSC_cand] > 1.2 && csctf_->trEta[iCSC_cand] < 2.1  )
                    {
                        hcsctfPt_Q2Q3_All -> Fill(pt_global);// fill global pt if we have csctf candidate 
                        for(int ihist = 0; ihist < N_thr; ihist++){ 
                           if(pt_csctf >= cutL1[ihist]){
                              hcsctfPt_Q2Q3_HLT[ihist] -> Fill(pt_global);
                              if(pt_global >= cutHLT[ihist])hcsctfEta_Q2Q3_HLT[ihist] -> Fill(eta_csctf); 
                              if(pt_global >= cutHLT[ihist])hcsctfPhi_Q2Q3_HLT[ihist] -> Fill(phi_csctf); 
                           }
                           if(pt_global >= cutHLT[ihist])hcsctfEta_Q2Q3_AllHLT[ihist] -> Fill(eta_csctf);
                           if(pt_global >= cutHLT[ihist])hcsctfPhi_Q2Q3_AllHLT[ihist] -> Fill(phi_csctf);
                        }
                    }
                  // end: golden region
                  // golden region Q_tight = 3 only
                  if(  (Q_tight == 3 ) &&
                       csctf_->trEta[iCSC_cand] > 1.2 && csctf_->trEta[iCSC_cand] < 2.1  )
                    {
                        hcsctfPt_Q3_All -> Fill(pt_global);// fill global pt if we have csctf candidate 
                        for(int ihist = 0; ihist < N_thr; ihist++){
                           if(pt_csctf >= cutL1[ihist]){
                              hcsctfPt_Q3_HLT[ihist] -> Fill(pt_global);
                              if(pt_global >= cutHLT[ihist])hcsctfEta_Q3_HLT[ihist] -> Fill(eta_csctf);
                              if(pt_global >= cutHLT[ihist])hcsctfPhi_Q3_HLT[ihist] -> Fill(phi_csctf);
                           }
                           if(pt_global >= cutHLT[ihist])hcsctfEta_Q3_AllHLT[ihist] -> Fill(eta_csctf);
                           if(pt_global >= cutHLT[ihist])hcsctfPhi_Q3_AllHLT[ihist] -> Fill(phi_csctf);
                        }
                    }
                  // end: golden region Q_tight = 3
                  // golden region Q_tight = 2 only
                  if(  (Q_tight == 2 ) &&
                       csctf_->trEta[iCSC_cand] > 1.2 && csctf_->trEta[iCSC_cand] < 2.1  )
                    {
                        hcsctfPt_Q2_All -> Fill(pt_global);// fill global pt if we have csctf candidate 
                        for(int ihist = 0; ihist < N_thr; ihist++){
                           if(pt_csctf >= cutL1[ihist]){
                              hcsctfPt_Q2_HLT[ihist] -> Fill(pt_global);
                              if(pt_global >= cutHLT[ihist])hcsctfEta_Q2_HLT[ihist] -> Fill(eta_csctf);
                              if(pt_global >= cutHLT[ihist])hcsctfPhi_Q2_HLT[ihist] -> Fill(phi_csctf);
                           }
                           if(pt_global >= cutHLT[ihist])hcsctfEta_Q2_AllHLT[ihist] -> Fill(eta_csctf);
                           if(pt_global >= cutHLT[ihist])hcsctfPhi_Q2_AllHLT[ihist] -> Fill(phi_csctf);
                        }
                    }
                  // end: golden region Q_tight = 2
                  // golden region Q_tight = 1 only
                  if(  (Q_tight == 1 ) &&
                       csctf_->trEta[iCSC_cand] > 1.2 && csctf_->trEta[iCSC_cand] < 2.1  )
                    {
                        unsigned int remerged = ( (csctf_->trPhi12[iCSC_cand]) | ((csctf_->trPhi23[iCSC_cand]) <<8) );
                        unsigned int deta12 = (csctf_->trPhi23[iCSC_cand]) >> 1;
                        unsigned int dphi12 = ((1<<8)-1) & remerged;
                        if (pt_csctf < 7. && pt_global > 7.){
                            cout << "higl pt_global(" <<pt_global <<" GeV) , low csctf (" <<
                            pt_csctf << " GeV), mode = " << mode << " trCharge = " << csctf_->trCharge[iCSC_cand] 
                            << " deta bit = " << deta12 << " dphi12 bit = " << dphi12 << endl;  
                            //cout << "1 " << csctf_->trLctQuality[iCSC_cand][ilct] << csctf_->trLctglobalEta[iCSC_cand][ilct]
                            //     << csctf_->trLctlocalPhi[iCSC_cand][ilct]
                            //     << csctf_->trLctTriggerCSCID[iCSC_cand][ilct] << csctf_->trLctCLCT_pattern[iCSC_cand][ilct] << endl;  
                            //for ME segments:
                            // valid   quality   eta   phi   cscid   clct_pattern lct Station
                            for (int ilct = 0; ilct < csctf_->lctSize; ilct++){
                            cout << "1 " << csctf_->lctQuality[ilct] << " " << csctf_->lctglobalEta[ilct]
                                 << " " << csctf_->lctlocalPhi[ilct]
                                 << " " << csctf_->lctTriggerCSCID[ilct]<< " "  << csctf_->lctCLCT_pattern[ilct] 
                                 << " " << csctf_->lctStation[ilct]<< endl;
                            }
                            cout << "++++++++++++++++++++++++++++++++++++" << endl;  
                        }
                        hcsctfPt_Q1_All -> Fill(pt_global);// fill global pt if we have csctf candidate 
                        for(int ihist = 0; ihist < N_thr; ihist++){
                           if(pt_csctf >= cutL1[ihist]){
                              hcsctfPt_Q1_HLT[ihist] -> Fill(pt_global);
                              if(pt_global >= cutHLT[ihist])hcsctfEta_Q1_HLT[ihist] -> Fill(eta_csctf);
                              if(pt_global >= cutHLT[ihist])hcsctfPhi_Q1_HLT[ihist] -> Fill(phi_csctf);
                           }
                           if(pt_global >= cutHLT[ihist])hcsctfEta_Q1_AllHLT[ihist] -> Fill(eta_csctf);
                           if(pt_global >= cutHLT[ihist])hcsctfPhi_Q1_AllHLT[ihist] -> Fill(phi_csctf);
                        }
                    }
                  // end: golden region Q_tight = 1



                  // golden region mode5
                  if(  (mode == 5) &&
                       csctf_->trEta[iCSC_cand] > 1.2 && csctf_->trEta[iCSC_cand] < 2.1  )
                    {
                        hcsctfPt_mode5_All -> Fill(pt_global);// fill global pt if we have csctf candidate 
                        for(int ihist = 0; ihist < N_thr; ihist++){
                           if(pt_csctf >= cutL1[ihist]){
                              hcsctfPt_mode5_HLT[ihist] -> Fill(pt_global);
                              if(pt_global >= cutHLT[ihist])hcsctfEta_mode5_HLT[ihist] -> Fill(eta_csctf);
                              if(pt_global >= cutHLT[ihist])hcsctfPhi_mode5_HLT[ihist] -> Fill(phi_csctf);
                           }
                           if(pt_global >= cutHLT[ihist])hcsctfEta_mode5_AllHLT[ihist] -> Fill(eta_csctf);
                           if(pt_global >= cutHLT[ihist])hcsctfPhi_mode5_AllHLT[ihist] -> Fill(phi_csctf);
                        }
                    }
                  // end: golden region
                  // golden region Q1 no mode 5
                  if(  (Q_tight == 1 && mode != 5 ) &&
                       csctf_->trEta[iCSC_cand] > 1.2 && csctf_->trEta[iCSC_cand] < 2.1  )
                    {
                        hcsctfPt_Q1nomode5_All -> Fill(pt_global);// fill global pt if we have csctf candidate 
                        for(int ihist = 0; ihist < N_thr; ihist++){
                           if(pt_csctf >= cutL1[ihist]){
                              hcsctfPt_Q1nomode5_HLT[ihist] -> Fill(pt_global);
                              if(pt_global >= cutHLT[ihist])hcsctfEta_Q1nomode5_HLT[ihist] -> Fill(eta_csctf);
                              if(pt_global >= cutHLT[ihist])hcsctfPhi_Q1nomode5_HLT[ihist] -> Fill(phi_csctf);
                           }
                           if(pt_global >= cutHLT[ihist])hcsctfEta_Q1nomode5_AllHLT[ihist] -> Fill(eta_csctf);
                           if(pt_global >= cutHLT[ihist])hcsctfPhi_Q1nomode5_AllHLT[ihist] -> Fill(phi_csctf);
                        }
                    }
                  // end: golden region Q1 no mode5


                  // high eta region
                  if(  (Q_tight == 3 ) &&
                       csctf_->trEta[iCSC_cand] > 2.1  )
                    {

                        if (pt_global < 2. && pt_csctf > -1.) hModeHQptRecoLt2etaGt2p1 -> Fill(mode);
                        if (pt_global < 2. && pt_csctf > -1.) hModeHQptRecoLt2nomode5etaGt2p1 -> Fill(mode);
                        if (pt_global < 5. && pt_csctf > -1.) hModeHQptRecoLt5etaGt2p1 -> Fill(mode);
                        if (pt_global < 5. && pt_csctf > -1.) hModeHQptRecoLt5nomode5etaGt2p1 -> Fill(mode);
                        if (pt_global > 10. && pt_csctf > -1.) hModeHQptRecoGt10etaGt2p1 -> Fill(mode);
                        if (pt_global > 10. && pt_csctf > -1.) hModeHQptRecoGt10nomode5etaGt2p1 -> Fill(mode);

                        hcsctfPt_Q3high_All -> Fill(pt_global);// fill global pt if we have csctf candidate 
                        for(int ihist = 0; ihist < N_thr; ihist++){
                           if(pt_csctf >= cutL1[ihist]){
                              hcsctfPt_Q3high_HLT[ihist] -> Fill(pt_global);
                              if(pt_global >= cutHLT[ihist])hcsctfEta_Q3high_HLT[ihist] -> Fill(eta_csctf);
                              if(pt_global >= cutHLT[ihist])hcsctfPhi_Q3high_HLT[ihist] -> Fill(phi_csctf);
                           }
                           if(pt_global >= cutHLT[ihist])hcsctfEta_Q3high_AllHLT[ihist] -> Fill(eta_csctf);
                           if(pt_global >= cutHLT[ihist])hcsctfPhi_Q3high_AllHLT[ihist] -> Fill(phi_csctf);
                        }
                    }
                  // end: high eta region
                  // high eta region Q2
                  if(  (Q_tight == 2 ) &&
                       csctf_->trEta[iCSC_cand] > 2.1  )
                    {
                        hcsctfPt_Q2high_All -> Fill(pt_global);// fill global pt if we have csctf candidate 
                        for(int ihist = 0; ihist < N_thr; ihist++){
                           if(pt_csctf >= cutL1[ihist]){
                              hcsctfPt_Q2high_HLT[ihist] -> Fill(pt_global);
                              if(pt_global >= cutHLT[ihist])hcsctfEta_Q2high_HLT[ihist] -> Fill(eta_csctf);
                              if(pt_global >= cutHLT[ihist])hcsctfPhi_Q2high_HLT[ihist] -> Fill(phi_csctf);
                           }
                           if(pt_global >= cutHLT[ihist])hcsctfEta_Q2high_AllHLT[ihist] -> Fill(eta_csctf);
                           if(pt_global >= cutHLT[ihist])hcsctfPhi_Q2high_AllHLT[ihist] -> Fill(phi_csctf);
                        }
                    }
                  // end: high eta region Q=2
                  // high eta region Q1 no mode 5
                  if(  (mode == 8 || mode == 9 || mode == 10 ) &&
                       csctf_->trEta[iCSC_cand] > 2.1  )
                    {
                        hcsctfPt_Q1nomode5high_All -> Fill(pt_global);// fill global pt if we have csctf candidate 
                        for(int ihist = 0; ihist < N_thr; ihist++){
                           if(pt_csctf >= cutL1[ihist]){
                              hcsctfPt_Q1nomode5high_HLT[ihist] -> Fill(pt_global);
                              if(pt_global >= cutHLT[ihist])hcsctfEta_Q1nomode5high_HLT[ihist] -> Fill(eta_csctf);
                              if(pt_global >= cutHLT[ihist])hcsctfPhi_Q1nomode5high_HLT[ihist] -> Fill(phi_csctf);
                           }
                           if(pt_global >= cutHLT[ihist])hcsctfEta_Q1nomode5high_AllHLT[ihist] -> Fill(eta_csctf);
                           if(pt_global >= cutHLT[ihist])hcsctfPhi_Q1nomode5high_AllHLT[ihist] -> Fill(phi_csctf);
                        }
                    }
                  // end: high eta region Q1 no mode 5


                  // high eta region, mode 5
                  if(  (mode == 5) &&
                       csctf_->trEta[iCSC_cand] > 2.1  )
                    {
                        if (pt_global < 2. && pt_csctf > -1.) hModeHQptRecoLt2etaGt2p1 -> Fill(mode);
                        if (pt_global < 5. && pt_csctf > -1.) hModeHQptRecoLt5etaGt2p1 -> Fill(mode);
                        if (pt_global > 10. && pt_csctf > -1.) hModeHQptRecoGt10etaGt2p1 -> Fill(mode);
                        hcsctfPt_mode5high_All -> Fill(pt_global);// fill global pt if we have csctf candidate 
                        for(int ihist = 0; ihist < N_thr; ihist++){
                           if(pt_csctf >= cutL1[ihist]){
                              hcsctfPt_mode5high_HLT[ihist] -> Fill(pt_global);
                              if(pt_global >= cutHLT[ihist])hcsctfEta_mode5high_HLT[ihist] -> Fill(eta_csctf);
                              if(pt_global >= cutHLT[ihist])hcsctfPhi_mode5high_HLT[ihist] -> Fill(phi_csctf);
                           }
                           if(pt_global >= cutHLT[ihist])hcsctfEta_mode5high_AllHLT[ihist] -> Fill(eta_csctf);
                           if(pt_global >= cutHLT[ihist])hcsctfPhi_mode5high_AllHLT[ihist] -> Fill(phi_csctf);
                        }
                    }
                  // end: high eta region, mode = 5


/////////////////////
                }//end CSC cand
          }// end cycle by reco moun
      } 
     }//ednd loop

  printhistos();
//////////////////////////////// 

//////////////////////////////// 
//////////////////////////////// 
// write histo to fil]
   theFile->Write();
   theFile->Close();

   cout << "root file cosed" << endl;
}

void L1CSCTF_tightRES_GOLDEN_PREL2011::bookhistos(){

  hDeltaR_matching = new TH1F("hDeltaR_matching", "#deltaR", 200,  0., 0.5);
  hDeltaPhi_matching = new TH1F("hDeltaPhi_matching", "#delta#phi", 200,  -0.5, 0.5);
  hDeltaEta_matching = new TH1F("hDeltaEta_matching", "#delta#eta", 200,  -0.5, 0.5);

  hModeHQptRecoLt2nomode5etaGt2p1 = new TH1F("hModeHQptRecoLt2nomode5etaGt2p1", "CSCTF |#eta| > 2.1, p_{T}^{reco} < 2 GeV", 4, 1.5, 5.5);
  hModeHQptRecoLt2etaGt2p1 = new TH1F("hModeHQptRecoLt2etaGt2p1", "CSCTF |#eta| > 2.1, p_{T}^{reco} < 2 GeV", 4, 1.5, 5.5);
  hModeHQptRecoLt5nomode5etaGt2p1 = new TH1F("hModeHQptRecoLt5nomode5etaGt2p1", "CSCTF |#eta| > 2.1, p_{T}^{reco} < 5 GeV", 4, 1.5, 5.5);
  hModeHQptRecoLt5etaGt2p1 = new TH1F("hModeHQptRecoLt5etaGt2p1", "CSCTF |#eta| > 2.1, p_{T}^{reco} < 5 GeV", 4, 1.5, 5.5);
  hModeHQptRecoGt10nomode5etaGt2p1 = new TH1F("hModeHQptRecoGt10nomode5etaGt2p1", "CSCTF |#eta| > 2.1, p_{T}^{reco} > 10 GeV", 4, 1.5, 5.5);
  hModeHQptRecoGt10etaGt2p1 = new TH1F("hModeHQptRecoGt10etaGt2p1", "CSCTF |#eta| > 2.1, p_{T}^{reco} > 10 GeV", 4, 1.5, 5.5);

   //const int NPThist1 = NPThist + 1;
   float PTbin1[NPThist+2];
   PTbin1[0] = 0.5;
   for(int iPT = 0; iPT < NPThist+1; iPT++){
      PTbin1[iPT+1] = PTbin[iPT];
   }
   float RESbin[101];
   for(int iRES = 0; iRES < 101; iRES++){
       RESbin[iRES] = -1 + 2./100.*float(iRES);
   }
  //overlap region
  hcsctfPt_DT_All = new TH1F("hcsctfPt_DT_All", "", NPThist,  PTbin);
  for(int ihist = 0; ihist < N_thr; ihist++){
      hcsctfPt_DT_HLT[ihist] = new TH1F(Form("hcsctfPt_DT_HLT%d",ihist),
                             Form("Overlap eta region, PT L1 %4.1f GeV cut",cutL1[ihist]), NPThist,  PTbin);
      hcsctfEta_DT_AllHLT[ihist] = new TH1F(Form("hcsctfEta_DT_AllHLT%d",ihist), 
                             Form("Overlap eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 10, 0.8, 1.3);
      hcsctfEta_DT_HLT[ihist] = new TH1F(Form("hcsctfEta_DT_HLT%d",ihist), 
                             Form("Overlap eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 10, 0.8, 1.3);
      hcsctfPhi_DT_AllHLT[ihist] = new TH1F(Form("hcsctfPhi_DT_AllHLT%d",ihist), 
                             Form("Overlap eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 12, 0, 2*Pi);
      hcsctfPhi_DT_HLT[ihist] = new TH1F(Form("hcsctfPhi_DT_HLT%d",ihist), 
                             Form("Overlap eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 12, 0, 2*Pi);
  }
  //golden region
  hcsctfPt_Q2Q3_All = new TH1F("hcsctfPt_Q2Q3_All", "", NPThist,  PTbin);
  hcsctfPt_Q1_All = new TH1F("hcsctfPt_Q1_All", "", NPThist,  PTbin);
  hcsctfPt_Q2_All = new TH1F("hcsctfPt_Q2_All", "", NPThist,  PTbin);
  hcsctfPt_Q3_All = new TH1F("hcsctfPt_Q3_All", "", NPThist,  PTbin);
  for(int ihist = 0; ihist < N_thr; ihist++){
      hcsctfPt_Q2Q3_HLT[ihist] = new TH1F(Form("hcsctfPt_Q2Q3_HLT%d",ihist),
                             Form("Golden eta region, PT L1 %4.1f GeV cut",cutL1[ihist]), NPThist,  PTbin);
      hcsctfEta_Q2Q3_AllHLT[ihist] = new TH1F(Form("hcsctfEta_Q2Q3_AllHLT%d",ihist), 
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 18, 1.2, 2.1);
      hcsctfEta_Q2Q3_HLT[ihist] = new TH1F(Form("hcsctfEta_Q2Q3_HLT%d",ihist), 
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 18, 1.2, 2.1);
      hcsctfPhi_Q2Q3_AllHLT[ihist] = new TH1F(Form("hcsctfPhi_Q2Q3_AllHLT%d",ihist), 
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 12, 0, 2*Pi);
      hcsctfPhi_Q2Q3_HLT[ihist] = new TH1F(Form("hcsctfPhi_Q2Q3_HLT%d",ihist), 
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 12, 0, 2*Pi);

      hcsctfPt_Q1_HLT[ihist] = new TH1F(Form("hcsctfPt_Q1_HLT%d",ihist),
                             Form("Golden eta region, PT L1 %4.1f GeV cut",cutL1[ihist]), NPThist,  PTbin);
      hcsctfEta_Q1_AllHLT[ihist] = new TH1F(Form("hcsctfEta_Q1_AllHLT%d",ihist),
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 18, 1.2, 2.1);
      hcsctfEta_Q1_HLT[ihist] = new TH1F(Form("hcsctfEta_Q1_HLT%d",ihist),
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 18, 1.2, 2.1);
      hcsctfPhi_Q1_AllHLT[ihist] = new TH1F(Form("hcsctfPhi_Q1_AllHLT%d",ihist),
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 12, 0, 2*Pi);
      hcsctfPhi_Q1_HLT[ihist] = new TH1F(Form("hcsctfPhi_Q1_HLT%d",ihist),
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 12, 0, 2*Pi);
  

      hcsctfPt_Q2_HLT[ihist] = new TH1F(Form("hcsctfPt_Q2_HLT%d",ihist),
                             Form("Golden eta region, PT L1 %4.1f GeV cut",cutL1[ihist]), NPThist,  PTbin);
      hcsctfEta_Q2_AllHLT[ihist] = new TH1F(Form("hcsctfEta_Q2_AllHLT%d",ihist),
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 18, 1.2, 2.1);
      hcsctfEta_Q2_HLT[ihist] = new TH1F(Form("hcsctfEta_Q2_HLT%d",ihist),
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 18, 1.2, 2.1);
      hcsctfPhi_Q2_AllHLT[ihist] = new TH1F(Form("hcsctfPhi_Q2_AllHLT%d",ihist),
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 12, 0, 2*Pi);
      hcsctfPhi_Q2_HLT[ihist] = new TH1F(Form("hcsctfPhi_Q2_HLT%d",ihist),
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 12, 0, 2*Pi);
  
      hcsctfPt_Q3_HLT[ihist] = new TH1F(Form("hcsctfPt_Q3_HLT%d",ihist),
                             Form("Golden eta region, PT L1 %4.1f GeV cut",cutL1[ihist]), NPThist,  PTbin);
      hcsctfEta_Q3_AllHLT[ihist] = new TH1F(Form("hcsctfEta_Q3_AllHLT%d",ihist),
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 18, 1.2, 2.1);
      hcsctfEta_Q3_HLT[ihist] = new TH1F(Form("hcsctfEta_Q3_HLT%d",ihist),
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 18, 1.2, 2.1);
      hcsctfPhi_Q3_AllHLT[ihist] = new TH1F(Form("hcsctfPhi_Q3_AllHLT%d",ihist),
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 12, 0, 2*Pi);
      hcsctfPhi_Q3_HLT[ihist] = new TH1F(Form("hcsctfPhi_Q3_HLT%d",ihist),
                             Form("Golden eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 12, 0, 2*Pi);
  

  }
  //golden region mode 5
  hcsctfPt_mode5_All = new TH1F("hcsctfPt_mode5_All", "", NPThist,  PTbin);
  for(int ihist = 0; ihist < N_thr; ihist++){
      hcsctfPt_mode5_HLT[ihist] = new TH1F(Form("hcsctfPt_mode5_HLT%d",ihist),
                             Form("Golden eta region mode 5, PT L1 %4.1f GeV cut",cutL1[ihist]), NPThist,  PTbin);
      hcsctfEta_mode5_AllHLT[ihist] = new TH1F(Form("hcsctfEta_mode5_AllHLT%d",ihist),
                             Form("Golden eta region mode 5, PT HLT %4.1f GeV cut",cutHLT[ihist]), 18, 1.2, 2.1);
      hcsctfEta_mode5_HLT[ihist] = new TH1F(Form("hcsctfEta_mode5_HLT%d",ihist),
                             Form("Golden eta region mode 5, PT HLT %4.1f GeV cut",cutHLT[ihist]), 18, 1.2, 2.1);
      hcsctfPhi_mode5_AllHLT[ihist] = new TH1F(Form("hcsctfPhi_mode5_AllHLT%d",ihist),
                             Form("Golden eta region mode 5, PT HLT %4.1f GeV cut",cutHLT[ihist]), 12, 0, 2*Pi);
      hcsctfPhi_mode5_HLT[ihist] = new TH1F(Form("hcsctfPhi_mode5_HLT%d",ihist),
                             Form("Golden eta region mode 5, PT HLT %4.1f GeV cut",cutHLT[ihist]), 12, 0, 2*Pi);
  }
  
  //golden region Q1 no mode 5
  hcsctfPt_Q1nomode5_All = new TH1F("hcsctfPt_Q1nomode5_All", "", NPThist,  PTbin);
  for(int ihist = 0; ihist < N_thr; ihist++){
      hcsctfPt_Q1nomode5_HLT[ihist] = new TH1F(Form("hcsctfPt_Q1nomode5_HLT%d",ihist),
                             Form("Golden eta region Q1 no mode 5, PT L1 %4.1f GeV cut",cutL1[ihist]), NPThist,  PTbin);
      hcsctfEta_Q1nomode5_AllHLT[ihist] = new TH1F(Form("hcsctfEta_Q1nomode5_AllHLT%d",ihist),
                             Form("Golden eta region Q1 no mode 5, PT HLT %4.1f GeV cut",cutHLT[ihist]), 18, 1.2, 2.1);
      hcsctfEta_Q1nomode5_HLT[ihist] = new TH1F(Form("hcsctfEta_Q1nomode5_HLT%d",ihist),
                             Form("Golden eta region Q1 no mode 5, PT HLT %4.1f GeV cut",cutHLT[ihist]), 18, 1.2, 2.1);
      hcsctfPhi_Q1nomode5_AllHLT[ihist] = new TH1F(Form("hcsctfPhi_Q1nomode5_AllHLT%d",ihist),
                             Form("Golden eta region Q1 no mode 5, PT HLT %4.1f GeV cut",cutHLT[ihist]), 12, 0, 2*Pi);
      hcsctfPhi_Q1nomode5_HLT[ihist] = new TH1F(Form("hcsctfPhi_Q1nomode5_HLT%d",ihist),
                             Form("Golden eta region Q1 no mode 5, PT HLT %4.1f GeV cut",cutHLT[ihist]), 12, 0, 2*Pi);
  }
  

  //high eta region
  hcsctfPt_Q3high_All = new TH1F("hcsctfPt_Q3high_All", "", NPThist_high,  PTbin_high);
  hcsctfPt_Q2high_All = new TH1F("hcsctfPt_Q2high_All", "", NPThist_high,  PTbin_high);
  hcsctfPt_Q1nomode5high_All = new TH1F("hcsctfPt_Q1nomode5high_All", "", NPThist_high,  PTbin_high);
  hcsctfPt_mode5high_All = new TH1F("hcsctfPt_mode5high_All", "", NPThist_high,  PTbin_high);
  for(int ihist = 0; ihist < N_thr; ihist++){
      hcsctfPt_Q3high_HLT[ihist] = new TH1F(Form("hcsctfPt_Q3high_HLT%d",ihist),
                             Form("High eta region, PT L1 %4.1f GeV cut",cutL1[ihist]), NPThist_high,  PTbin_high);
      hcsctfEta_Q3high_AllHLT[ihist] = new TH1F(Form("hcsctfEta_Q3high_AllHLT%d",ihist), 
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 4, 2.1, 2.5);
      hcsctfEta_Q3high_HLT[ihist] = new TH1F(Form("hcsctfEta_Q3high_HLT%d",ihist), 
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 4, 2.1, 2.5);
      hcsctfPhi_Q3high_AllHLT[ihist] = new TH1F(Form("hcsctfPhi_Q3high_AllHLT%d",ihist), 
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 6, 0., 2.*Pi); // 60 degree bin
      hcsctfPhi_Q3high_HLT[ihist] = new TH1F(Form("hcsctfPhi_Q3high_HLT%d",ihist), 
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 6, 0., 2*Pi); // 60 degree bin

      hcsctfPt_Q2high_HLT[ihist] = new TH1F(Form("hcsctfPt_Q2high_HLT%d",ihist),
                             Form("High eta region, PT L1 %4.1f GeV cut",cutL1[ihist]), NPThist_high,  PTbin_high);
      hcsctfEta_Q2high_AllHLT[ihist] = new TH1F(Form("hcsctfEta_Q2high_AllHLT%d",ihist),
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 4, 2.1, 2.5);
      hcsctfEta_Q2high_HLT[ihist] = new TH1F(Form("hcsctfEta_Q2high_HLT%d",ihist),
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 4, 2.1, 2.5);
      hcsctfPhi_Q2high_AllHLT[ihist] = new TH1F(Form("hcsctfPhi_Q2high_AllHLT%d",ihist),
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 6, 0., 2.*Pi); // 60 degree bin
      hcsctfPhi_Q2high_HLT[ihist] = new TH1F(Form("hcsctfPhi_Q2high_HLT%d",ihist),
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 6, 0., 2*Pi); // 60 degree bin

      hcsctfPt_Q1nomode5high_HLT[ihist] = new TH1F(Form("hcsctfPt_Q1nomode5high_HLT%d",ihist),
                             Form("High eta region, PT L1 %4.1f GeV cut",cutL1[ihist]), NPThist_high,  PTbin_high);
      hcsctfEta_Q1nomode5high_AllHLT[ihist] = new TH1F(Form("hcsctfEta_Q1nomode5high_AllHLT%d",ihist),
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 4, 2.1, 2.5);
      hcsctfEta_Q1nomode5high_HLT[ihist] = new TH1F(Form("hcsctfEta_Q1nomode5high_HLT%d",ihist),
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 4, 2.1, 2.5);
      hcsctfPhi_Q1nomode5high_AllHLT[ihist] = new TH1F(Form("hcsctfPhi_Q1nomode5high_AllHLT%d",ihist),
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 6, 0., 2.*Pi); // 60 degree bin
      hcsctfPhi_Q1nomode5high_HLT[ihist] = new TH1F(Form("hcsctfPhi_Q1nomode5high_HLT%d",ihist),
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 6, 0., 2*Pi); // 60 degree bin

      hcsctfPt_mode5high_HLT[ihist] = new TH1F(Form("hcsctfPt_mode5high_HLT%d",ihist),
                             Form("High eta region, PT L1 %4.1f GeV cut",cutL1[ihist]), NPThist_high,  PTbin_high);
      hcsctfEta_mode5high_AllHLT[ihist] = new TH1F(Form("hcsctfEta_mode5high_AllHLT%d",ihist),
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 4, 2.1, 2.5);
      hcsctfEta_mode5high_HLT[ihist] = new TH1F(Form("hcsctfEta_mode5high_HLT%d",ihist),
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 4, 2.1, 2.5);
      hcsctfPhi_mode5high_AllHLT[ihist] = new TH1F(Form("hcsctfPhi_mode5high_AllHLT%d",ihist),
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 6, 0., 2.*Pi); // 60 degree bin
      hcsctfPhi_mode5high_HLT[ihist] = new TH1F(Form("hcsctfPhi_mode5high_HLT%d",ihist),
                             Form("High eta region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 6, 0., 2*Pi); // 60 degree bin

}
  //high mode 8 eta region
  hcsctfPt_mode8high_All = new TH1F("hcsctfPt_mode8high_All", "", NPThist_high,  PTbin_high);
  for(int ihist = 0; ihist < N_thr; ihist++){
      hcsctfPt_mode8high_HLT[ihist] = new TH1F(Form("hcsctfPt_mode8high_HLT%d",ihist),
                             Form("High eta>0 region, PT L1 %4.1f GeV cut",cutL1[ihist]), NPThist_high,  PTbin_high);
      hcsctfEta_mode8high_AllHLT[ihist] = new TH1F(Form("hcsctfEta_mode8high_AllHLT%d",ihist),
                             Form("High eta>0 region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 4, 2.1, 2.5);
      hcsctfEta_mode8high_HLT[ihist] = new TH1F(Form("hcsctfEta_mode8high_HLT%d",ihist),
                             Form("High eta>0 region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 4, 2.1, 2.5);
      hcsctfPhi_mode8high_AllHLT[ihist] = new TH1F(Form("hcsctfPhi_mode8high_AllHLT%d",ihist),
                             Form("High eta>0 region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 6, 0., 2.*Pi); // 60 degree bin
      hcsctfPhi_mode8high_HLT[ihist] = new TH1F(Form("hcsctfPhi_mode8high_HLT%d",ihist),
                             Form("High eta>0 region, PT HLT %4.1f GeV cut",cutHLT[ihist]), 6, 0., 2*Pi); // 60 degree bin
  }

  hgoldenQ3_pthigh_dphi12 = new TH1F("hgoldenQ3_pthigh_dphi12", "", 100, 0, 0.1);
  hgoldenQ3_pthigh_dphi23 = new TH1F("hgoldenQ3_pthigh_dphi23", "", 20, -0.02, 0.02);
  hgoldenQ2_pthigh_dphi12 = new TH1F("hgoldenQ2_pthigh_dphi12", "", 100, 0, 0.1);
  hgoldenQ2_pthigh_dphi23 = new TH1F("hgoldenQ2_pthigh_dphi23", "", 16, -0.5, 15.5);

  hoverlap_pthigh_dphi12 = new TH1F("hoverlap_pthigh_dphi12","", 100, 0, 0.05);
  hoverlap_pthigh_phiBend = new TH1F("hoverlap_pthigh_phiBend","", 31, -15.5, 15.5);
  //
  for(int ihist = 0; ihist < N_cutPT; ihist++){
     hRate_global_[ihist] = new TH1F(Form("hRate_global_%d",ihist),
                             Form("Rate vs ETA for PT_global >= %4.1f GeV cut",cutPT[ihist]), 32, 0.9, 2.5 );
     //new
     hRate_Q1_[ihist] = new TH1F(Form("hRate_Q1_%d",ihist),
                             Form("Rate vs ETA for PT L1 >= %4.1f GeV cut",cutPT[ihist]), 32, 0.9, 2.5 );
     hRate_Q2_[ihist] = new TH1F(Form("hRate_Q2_%d",ihist),
                             Form("Rate vs ETA for PT L1 >= %4.1f GeV cut",cutPT[ihist]), 32, 0.9, 2.5 );
     hRate_Q3_[ihist] = new TH1F(Form("hRate_Q3_%d",ihist),
                             Form("Rate vs ETA for PT L1 >= %4.1f GeV cut",cutPT[ihist]), 32, 0.9, 2.5 );
 }   
  //
}
void L1CSCTF_tightRES_GOLDEN_PREL2011::printhistos(){
/*
//      printf("z1: gROOT Reset \n");
//        gROOT->Reset();
//        gROOT->SetStyle("Plain");
        gStyle->Reset();
        gStyle->SetTitleFont(42);           // title font
        gStyle->SetTitleFontSize(0.07);     // title font size
        gStyle->SetLabelSize(0.05,"xy");     //
        gStyle->SetStatFontSize(0.07);     //for box size
        //gStyle->SetStatX(0.97);     // for box x position
        //gStyle->SetStatW(0.25);     // for box width
        //gStyle->SetOptFit(1111); // pcev
        //gStyle->SetPalette(1);
        //gStyle -> SetOptStat(0); //remove statistic 
        gStyle->SetTitleOffset(1.2,"xy");
        //gStyle->SetTitleOffset(1.5,"x");
        gStyle->SetTitleSize(0.05,"xyz"); // axis titles
        //gStyle->SetTitleSize(0.05,"h"); // histogram title
        gStyle->SetOptTitle(0);             // title on/off
        gStyle->SetLineWidth(1.5);
        gStyle->SetFillColor(0);
        gStyle->SetFrameFillStyle(0);
  gStyle->SetCanvasColor(kWhite);     // background is no longer mouse-dropping white
  gStyle->SetPalette(1,0);            // blue to red false color palette. Use 9 for b/w
  gStyle->SetCanvasBorderMode(0);     // turn off canvas borders
  gStyle->SetPadBorderMode(0);
//---=[ Pad style ]=----------------
        Float_t LeftOffset = 0.15;
        Float_t TopOffset = 0.15;
        gStyle->SetPadTopMargin(TopOffset);
        gStyle->SetPadBottomMargin(LeftOffset);
        gStyle->SetPadRightMargin(TopOffset);
        gStyle->SetPadLeftMargin(LeftOffset);

// Force this style on all histograms
        gROOT->ForceStyle();
*/
//  setTDRStyle();

//calculate efficiency
// overlap
  TGraphAsymmErrors* effPt_DT[N_thr]; 
  TGraphAsymmErrors* effEta_DT[N_thr];
  TGraphAsymmErrors* effPhi_DT[N_thr];
// golden eta
  TGraphAsymmErrors* effPt_Q2Q3[N_thr]; 
  TGraphAsymmErrors* effEta_Q2Q3[N_thr];
  TGraphAsymmErrors* effPhi_Q2Q3[N_thr];
  TGraphAsymmErrors* effPt_Q1[N_thr]; 
  TGraphAsymmErrors* effEta_Q1[N_thr];
  TGraphAsymmErrors* effPhi_Q1[N_thr];
  TGraphAsymmErrors* effPt_Q2[N_thr]; 
  TGraphAsymmErrors* effEta_Q2[N_thr];
  TGraphAsymmErrors* effPhi_Q2[N_thr];
  TGraphAsymmErrors* effPt_Q3[N_thr]; 
  TGraphAsymmErrors* effEta_Q3[N_thr];
  TGraphAsymmErrors* effPhi_Q3[N_thr];
// golden eta mode 5
  TGraphAsymmErrors* effPt_mode5[N_thr]; 
  TGraphAsymmErrors* effEta_mode5[N_thr];
  TGraphAsymmErrors* effPhi_mode5[N_thr];
// golden eta Q1 no mode5 
  TGraphAsymmErrors* effPt_Q1nomode5[N_thr]; 
  TGraphAsymmErrors* effEta_Q1nomode5[N_thr];
  TGraphAsymmErrors* effPhi_Q1nomode5[N_thr];
// high eta eta
  TGraphAsymmErrors* effPt_Q3high[N_thr]; 
  TGraphAsymmErrors* effEta_Q3high[N_thr];
  TGraphAsymmErrors* effPhi_Q3high[N_thr];
  TGraphAsymmErrors* effPt_Q2high[N_thr]; 
  TGraphAsymmErrors* effEta_Q2high[N_thr];
  TGraphAsymmErrors* effPhi_Q2high[N_thr];
  TGraphAsymmErrors* effPt_Q1nomode5high[N_thr]; 
  TGraphAsymmErrors* effEta_Q1nomode5high[N_thr];
  TGraphAsymmErrors* effPhi_Q1nomode5high[N_thr];
  TGraphAsymmErrors* effPt_mode5high[N_thr]; 
  TGraphAsymmErrors* effEta_mode5high[N_thr];
  TGraphAsymmErrors* effPhi_mode5high[N_thr];
  TLine *linePt[N_thr];
  for(int ihist = 0; ihist < N_thr; ihist++){
      linePt[ihist] = new TLine(cutL1[ihist],0.,cutL1[ihist],1.05);
      //golden eta
      effPt_Q2Q3[ihist] = new TGraphAsymmErrors(hcsctfPt_Q2Q3_HLT[ihist],hcsctfPt_Q2Q3_All, "");
      effEta_Q2Q3[ihist] = new TGraphAsymmErrors(hcsctfEta_Q2Q3_HLT[ihist],hcsctfEta_Q2Q3_AllHLT[ihist], "");
      effPhi_Q2Q3[ihist] = new TGraphAsymmErrors(hcsctfPhi_Q2Q3_HLT[ihist],hcsctfPhi_Q2Q3_AllHLT[ihist], "");

      effPt_Q1[ihist] = new TGraphAsymmErrors(hcsctfPt_Q1_HLT[ihist],hcsctfPt_Q1_All, "");
      effEta_Q1[ihist] = new TGraphAsymmErrors(hcsctfEta_Q1_HLT[ihist],hcsctfEta_Q1_AllHLT[ihist], "");
      effPhi_Q1[ihist] = new TGraphAsymmErrors(hcsctfPhi_Q1_HLT[ihist],hcsctfPhi_Q1_AllHLT[ihist], "");

      effPt_Q2[ihist] = new TGraphAsymmErrors(hcsctfPt_Q2_HLT[ihist],hcsctfPt_Q2_All, "");
      effEta_Q2[ihist] = new TGraphAsymmErrors(hcsctfEta_Q2_HLT[ihist],hcsctfEta_Q2_AllHLT[ihist], "");
      effPhi_Q2[ihist] = new TGraphAsymmErrors(hcsctfPhi_Q2_HLT[ihist],hcsctfPhi_Q2_AllHLT[ihist], "");

      effPt_Q3[ihist] = new TGraphAsymmErrors(hcsctfPt_Q3_HLT[ihist],hcsctfPt_Q3_All, "");
      effEta_Q3[ihist] = new TGraphAsymmErrors(hcsctfEta_Q3_HLT[ihist],hcsctfEta_Q3_AllHLT[ihist], "");
      effPhi_Q3[ihist] = new TGraphAsymmErrors(hcsctfPhi_Q3_HLT[ihist],hcsctfPhi_Q3_AllHLT[ihist], "");

      //golden eta mode 5
      effPt_mode5[ihist] = new TGraphAsymmErrors(hcsctfPt_mode5_HLT[ihist],hcsctfPt_mode5_All, "");
      effEta_mode5[ihist] = new TGraphAsymmErrors(hcsctfEta_mode5_HLT[ihist],hcsctfEta_mode5_AllHLT[ihist], "");
      effPhi_mode5[ihist] = new TGraphAsymmErrors(hcsctfPhi_mode5_HLT[ihist],hcsctfPhi_mode5_AllHLT[ihist], "");
      //golden eta Q1 no mode 5
      effPt_Q1nomode5[ihist] = new TGraphAsymmErrors(hcsctfPt_Q1nomode5_HLT[ihist],hcsctfPt_Q1nomode5_All, "");
      effEta_Q1nomode5[ihist] = new TGraphAsymmErrors(hcsctfEta_Q1nomode5_HLT[ihist],hcsctfEta_Q1nomode5_AllHLT[ihist], "");
      effPhi_Q1nomode5[ihist] = new TGraphAsymmErrors(hcsctfPhi_Q1nomode5_HLT[ihist],hcsctfPhi_Q1nomode5_AllHLT[ihist], "");
      //overlap
      effPt_DT[ihist] = new TGraphAsymmErrors(hcsctfPt_DT_HLT[ihist],hcsctfPt_DT_All, "");
      effEta_DT[ihist] = new TGraphAsymmErrors(hcsctfEta_DT_HLT[ihist],hcsctfEta_DT_AllHLT[ihist], "");
      effPhi_DT[ihist] = new TGraphAsymmErrors(hcsctfPhi_DT_HLT[ihist],hcsctfPhi_DT_AllHLT[ihist], "");
      //high eta region
      effPt_Q3high[ihist] = new TGraphAsymmErrors(hcsctfPt_Q3high_HLT[ihist],hcsctfPt_Q3high_All, "");
      effEta_Q3high[ihist] = new TGraphAsymmErrors(hcsctfEta_Q3high_HLT[ihist],hcsctfEta_Q3high_AllHLT[ihist], "");
      effPhi_Q3high[ihist] = new TGraphAsymmErrors(hcsctfPhi_Q3high_HLT[ihist],hcsctfPhi_Q3high_AllHLT[ihist], "");
      effPt_Q2high[ihist] = new TGraphAsymmErrors(hcsctfPt_Q2high_HLT[ihist],hcsctfPt_Q2high_All, "");
      effEta_Q2high[ihist] = new TGraphAsymmErrors(hcsctfEta_Q2high_HLT[ihist],hcsctfEta_Q2high_AllHLT[ihist], "");
      effPhi_Q2high[ihist] = new TGraphAsymmErrors(hcsctfPhi_Q2high_HLT[ihist],hcsctfPhi_Q2high_AllHLT[ihist], "");
      effPt_Q1nomode5high[ihist] = new TGraphAsymmErrors(hcsctfPt_Q1nomode5high_HLT[ihist],hcsctfPt_Q1nomode5high_All, "");
      effEta_Q1nomode5high[ihist] = new TGraphAsymmErrors(hcsctfEta_Q1nomode5high_HLT[ihist],hcsctfEta_Q1nomode5high_AllHLT[ihist], "");
      effPhi_Q1nomode5high[ihist] = new TGraphAsymmErrors(hcsctfPhi_Q1nomode5high_HLT[ihist],hcsctfPhi_Q1nomode5high_AllHLT[ihist], "");
      effPt_mode5high[ihist] = new TGraphAsymmErrors(hcsctfPt_mode5high_HLT[ihist],hcsctfPt_mode5high_All, "");
      effEta_mode5high[ihist] = new TGraphAsymmErrors(hcsctfEta_mode5high_HLT[ihist],hcsctfEta_mode5high_AllHLT[ihist], "");
      effPhi_mode5high[ihist] = new TGraphAsymmErrors(hcsctfPhi_mode5high_HLT[ihist],hcsctfPhi_mode5high_AllHLT[ihist], "");
  }
//////////////////////////////////////////////////////
  gStyle -> SetOptStat(0); // no statistics 
  gStyle->SetOptFit(0000); 
  gStyle->SetOptTitle(0);             // title on/off
  //TString titleCanvas="CSCTF, golden #eta region: 1.2 < #eta <2.1";
  TString titleCanvas="";
  //TString titlePrel = "CMS Preliminary 2010 (7 TeV)";
  //TString titlePrel = "PT_METHOD = 24 (2010, 7 TeV)";
  //TString titlePrel = "PT_METHOD = 24 CORR. (2010, 7 TeV)";
  //TString titlePrel = "PT_METHOD = 24 MAX CORR. (2010, 7 TeV)";
  //TString titlePrel1 = "CMS Preliminary 2011";
  //TString titlePrel = "CMS Preliminary 2011 (PTLUT2011)";

  //TString titlePrel1 = "CMS PrePreliminary 2011";
  //TString titlePrel = "CMS PrePreliminary 2011 (PTLUT2011)";
  //TString titlePrel2 = "(PTLUT2011)";

  TString titlePrel1 = "PTLUT2012DATA";
  TString titlePrel = "PTLUT2012DATA";
  TString titlePrel2 = "";
  
//////////////////////////////////////////////////////
/// ************* golden eta ***********************/////
  int Iregion = 1; // 0 - overlap, 1 - golden, 2 - high eta
  TString gifname = titlePrel+"_Eff_PT_golden";
  fillEffPt(effPt_Q2Q3, linePt, titleCanvas, titlePrel1+", |#eta| = 1.2-2.1, Q2&Q3", titlePrel2, gifname, Iregion); 
//////////////////////////////////////////////////////
  //TString titleX = "#eta of Global Muon"; 
  TString titleX = "#eta of CSCTF Muon";
  gifname = titlePrel+"_Eff_ETA_golden";
  //gifname = titlePrel+"_Eff_ETA_golden.pdf";
  fillEffEta(effEta_Q2Q3, titleCanvas, titlePrel+", |#eta| = 1.2-2.1, Q2&Q3", titleX, gifname); 
//////////////////////////////////////////////////////
  //titleX = "#phi of Global Muon, (rad)"; 
  titleX = "#phi of CSCTF Muon, (rad)"; 
  gifname = titlePrel+"_Eff_PHI_golden";
  //gifname = titlePrel+"_Eff_PHI_golden.pdf";
  fillEffEta(effPhi_Q2Q3, titleCanvas, titlePrel+", |#eta| = 1.2-2.1, Q2&Q3", titleX, gifname); 
//////////////////////////////////////////////////////

/// ************* golden Q1 ***********************/////
  Iregion = 1; // 0 - overlap, 1 - golden, 2 - high eta
  gifname = titlePrel+"_Eff_PT_golden_Q1";
  fillEffPt(effPt_Q1, linePt, titleCanvas, titlePrel1+", |#eta| = 1.2-2.1, Q1", titlePrel2, gifname, Iregion);
//////////////////////////////////////////////////////
  //TString titleX = "#eta of Global Muon"; 
  titleX = "#eta of CSCTF Muon";
  gifname = titlePrel+"_Eff_ETA_golden_Q1";
  fillEffEta(effEta_Q1, titleCanvas, titlePrel+", |#eta| = 1.2-2.1, Q1", titleX, gifname);
//////////////////////////////////////////////////////
  //titleX = "#phi of Global Muon, (rad)"; 
  titleX = "#phi of CSCTF Muon, (rad)";
  gifname = titlePrel+"_Eff_PHI_golden_Q1";
  fillEffEta(effPhi_Q1, titleCanvas, titlePrel+", |#eta| = 1.2-2.1, Q1", titleX, gifname);

/// ************* golden Q2 ***********************/////
  Iregion = 1; // 0 - overlap, 1 - golden, 2 - high eta
  gifname = titlePrel+"_Eff_PT_golden_Q2";
  fillEffPt(effPt_Q2, linePt, titleCanvas, titlePrel1+", |#eta| = 1.2-2.1, Q2", titlePrel2, gifname, Iregion);
//////////////////////////////////////////////////////
  //TString titleX = "#eta of Global Muon"; 
  titleX = "#eta of CSCTF Muon";
  gifname = titlePrel+"_Eff_ETA_golden_Q2";
  fillEffEta(effEta_Q2, titleCanvas, titlePrel+", |#eta| = 1.2-2.1, Q2", titleX, gifname);
//////////////////////////////////////////////////////
  //titleX = "#phi of Global Muon, (rad)"; 
  titleX = "#phi of CSCTF Muon, (rad)";
  gifname = titlePrel+"_Eff_PHI_golden_Q2";
  fillEffEta(effPhi_Q2, titleCanvas, titlePrel+", |#eta| = 1.2-2.1, Q2", titleX, gifname);

/// ************* golden Q3 ***********************/////
  Iregion = 1; // 0 - overlap, 1 - golden, 2 - high eta
  gifname = titlePrel+"_Eff_PT_golden_Q3";
  fillEffPt(effPt_Q3, linePt, titleCanvas, titlePrel1+", |#eta| = 1.2-2.1, Q3", titlePrel2, gifname, Iregion);
//////////////////////////////////////////////////////
  //TString titleX = "#eta of Global Muon"; 
  titleX = "#eta of CSCTF Muon";
  gifname = titlePrel+"_Eff_ETA_golden_Q3";
  fillEffEta(effEta_Q3, titleCanvas, titlePrel+", |#eta| = 1.2-2.1, Q3", titleX, gifname);
//////////////////////////////////////////////////////
  //titleX = "#phi of Global Muon, (rad)"; 
  titleX = "#phi of CSCTF Muon, (rad)";
  gifname = titlePrel+"_Eff_PHI_golden_Q3";
  fillEffEta(effPhi_Q3, titleCanvas, titlePrel+", |#eta| = 1.2-2.1, Q3", titleX, gifname);


/// ************* golden eta mode5 ***********************/////
  Iregion = 1; // 0 - overlap, 1 - golden, 2 - high eta
  gifname = titlePrel+"_Eff_PT_golden_mode5";
  fillEffPt(effPt_mode5, linePt, titleCanvas, titlePrel1+", |#eta| = 1.2-2.1, mode = 5", titlePrel2, gifname, Iregion);
//////////////////////////////////////////////////////
  //TString titleX = "#eta of Global Muon"; 
  titleX = "#eta of CSCTF Muon";
  gifname = titlePrel+"_Eff_ETA_golden_mode5";
  fillEffEta(effEta_mode5, titleCanvas, titlePrel+", |#eta| = 1.2-2.1, mode = 5", titleX, gifname);
//////////////////////////////////////////////////////
  //titleX = "#phi of Global Muon, (rad)"; 
  titleX = "#phi of CSCTF Muon, (rad)";
  gifname = titlePrel+"_Eff_PHI_golden_mode5";
  fillEffEta(effPhi_mode5, titleCanvas, titlePrel+", |#eta| = 1.2-2.1, mode = 5", titleX, gifname);

/// ************* golden eta Q1 no mode5***********************/////
  Iregion = 1; // 0 - overlap, 1 - golden, 2 - high eta
  gifname = titlePrel+"_Eff_PT_golden_Q1nomode5";
  fillEffPt(effPt_Q1nomode5, linePt, titleCanvas, titlePrel1+", |#eta| = 1.2-2.1", titlePrel2+"Q1 & no mode 5", gifname, Iregion);
//////////////////////////////////////////////////////
  //TString titleX = "#eta of Global Muon"; 
  titleX = "#eta of CSCTF Muon";
  gifname = titlePrel+"_Eff_ETA_golden_Q1nomode5";
  fillEffEta(effEta_Q1nomode5, titleCanvas, titlePrel+", |#eta| = 1.2-2.1, Q1 & no mode 5", titleX, gifname);
//////////////////////////////////////////////////////
  //titleX = "#phi of Global Muon, (rad)"; 
  titleX = "#phi of CSCTF Muon, (rad)";
  gifname = titlePrel+"_Eff_PHI_golden_Q1nomode5";
  fillEffEta(effPhi_Q1nomode5, titleCanvas, titlePrel+", |#eta| = 1.2-2.1, Q1 & no mode 5", titleX, gifname);

/// ************* overlap ***********************/////
///*
  Iregion = 0; // 0 - overlap, 1 - golden, 2 - high eta
  gifname = titlePrel+"_Eff_PT_DT";
  fillEffPt(effPt_DT, linePt, titleCanvas, titlePrel1+", CSC&DT Q3", titlePrel2, gifname, Iregion);
//////////////////////////////////////////////////////
  //titleX = "#eta of Global Muon";
  titleX = "#eta of CSCTF Muon";
  gifname = titlePrel+"_Eff_ETA_DT";
  fillEffEta(effEta_DT, titleCanvas, titlePrel+", CSC&DT Q3", titleX, gifname);
//////////////////////////////////////////////////////
  //titleX = "#phi of Global Muon, (rad)";
  titleX = "#phi of CSCTF Muon, (rad)";
  gifname = titlePrel+"_Eff_PHI_DT";
  fillEffEta(effPhi_DT, titleCanvas, titlePrel+", CSC&DT Q3", titleX, gifname);
//////////////////////////////////////////////////////
/// ************* high eta region ***********************/////
///*
  //titlePrel = "";
  Iregion = 2; // 0 - overlap, 1 - golden, 2 - high eta
  gifname = titlePrel+"_Eff_PT_high";
  fillEffPt(effPt_Q3high, linePt, titleCanvas, titlePrel1+", |#eta|>2.1, Q3", titlePrel2, gifname, Iregion);
//////////////////////////////////////////////////////
  //titleX = "#eta of Global Muon";
  titleX = "#eta of CSCTF Muon";
  gifname = titlePrel+"_Eff_ETA_high";
  fillEffEta(effEta_Q3high, titleCanvas, titlePrel+", |#eta|>2.1, Q3", titleX, gifname);
//////////////////////////////////////////////////////
  //titleX = "#phi of Global Muon, (rad)";
  titleX = "#phi of CSCTF Muon, (rad)";
  gifname = titlePrel+"_Eff_PHI_high";
  fillEffEta(effPhi_Q3high, titleCanvas, titlePrel+", |#eta|>2.1, Q3", titleX, gifname);
//////////////////////////////////////////////////////

/// ************* high eta region ***********************/////
///*
  //titlePrel = "";
  Iregion = 2; // 0 - overlap, 1 - golden, 2 - high eta
  gifname = titlePrel+"_Eff_PT_high_Q2";
  fillEffPt(effPt_Q2high, linePt, titleCanvas, titlePrel1+", |#eta|>2.1, Q2", titlePrel2, gifname, Iregion);
//////////////////////////////////////////////////////
  //titleX = "#eta of Global Muon";
  titleX = "#eta of CSCTF Muon";
  gifname = titlePrel+"_Eff_ETA_high_Q2";
  fillEffEta(effEta_Q2high, titleCanvas, titlePrel+", |#eta|>2.1, Q2", titleX, gifname);
//////////////////////////////////////////////////////
  //titleX = "#phi of Global Muon, (rad)";
  titleX = "#phi of CSCTF Muon, (rad)";
  gifname = titlePrel+"_Eff_PHI_high_Q2";
  fillEffEta(effPhi_Q2high, titleCanvas, titlePrel+", |#eta|>2.1, Q2", titleX, gifname);
//////////////////////////////////////////////////////
/// ************* high eta region ***********************/////
///*
  //titlePrel = "";
  Iregion = 2; // 0 - overlap, 1 - golden, 2 - high eta
  gifname = titlePrel+"_Eff_PT_high_Q1nomode5";
  fillEffPt(effPt_Q1nomode5high, linePt, titleCanvas, titlePrel1+", |#eta|>2.1, Q1 & no mode5", titlePrel2, gifname, Iregion);
//////////////////////////////////////////////////////
  //titleX = "#eta of Global Muon";
  titleX = "#eta of CSCTF Muon";
  gifname = titlePrel+"_Eff_ETA_high_Q1nomode5";
  fillEffEta(effEta_Q1nomode5high, titleCanvas, titlePrel+", |#eta|>2.1, Q1 & no mode5", titleX, gifname);
//////////////////////////////////////////////////////
  //titleX = "#phi of Global Muon, (rad)";
  titleX = "#phi of CSCTF Muon, (rad)";
  gifname = titlePrel+"_Eff_PHI_high_Q1nomode5";
  fillEffEta(effPhi_Q1nomode5high, titleCanvas, titlePrel+", |#eta|>2.1, Q1 & no mode5", titleX, gifname);
//////////////////////////////////////////////////////


/// ************* high eta region mode5***********************/////
///*
  //titlePrel = "";
  Iregion = 2; // 0 - overlap, 1 - golden, 2 - high eta
  gifname = titlePrel+"_Eff_PT_high_mode5";
  fillEffPt(effPt_mode5high, linePt, titleCanvas, titlePrel1+", |#eta|>2.1, mode = 5", titlePrel2, gifname, Iregion);
//////////////////////////////////////////////////////
  //titleX = "#eta of Global Muon";
  titleX = "#eta of CSCTF Muon";
  gifname = titlePrel+"_Eff_ETA_high_mode5";
  fillEffEta(effEta_mode5high, titleCanvas, titlePrel+", |#eta|>2.1, mode = 5", titleX, gifname);
//////////////////////////////////////////////////////
  //titleX = "#phi of Global Muon, (rad)";
  titleX = "#phi of CSCTF Muon, (rad)";
  gifname = titlePrel+"_Eff_PHI_high_mode5";
  fillEffEta(effPhi_mode5high, titleCanvas, titlePrel+", |#eta|>2.1, mode = 5", titleX, gifname);
//////////////////////////////////////////////////////



}
void L1CSCTF_tightRES_GOLDEN_PREL2011::fillEffPt(TGraphAsymmErrors* histo[], TLine* line[],  
                                        TString titleCanvas, TString titlePrel1, TString titlePrel2, TString gifname, int Iregion){
  TCanvas* Eff_PT_golden = new TCanvas("Eff_PT_golden", "", 0, 0, 1900, 1200);
  //TCanvas* Eff_PT_golden = new TCanvas("Eff_PT_golden", "", 0, 0, 1000, 600);
  gPad -> SetLogx();
  gPad -> SetGrid();

  // draw eff: 3 GeV 
  histo[0]->GetYaxis() -> SetRangeUser(0., 1.05);
  //histo[0]->GetXaxis() -> SetRangeUser(2., 140.);
  float xRange_min = PtCut;
  if(xRange_min < 2.) xRange_min = 2.; 
  histo[0]->GetXaxis() -> SetRangeUser(xRange_min, 100.);
  histo[0]->GetXaxis()->SetTitle("P_{T} of Global Muon, (GeV/c)");
  //histo[0]_3->GetXaxis()->CenterTitle();
  histo[0]->GetXaxis()->SetTitleSize(0.04);
  histo[0]->GetXaxis()->SetTitleOffset(1.2);
  histo[0]->GetYaxis()->SetTitle("Threshold Efficiency");
  histo[0]->GetYaxis()->SetTitleSize(0.04);
  histo[0]->GetYaxis()->SetTitleOffset(1.0);

  TF1* fitPTfunc = new TF1("fitPTfunc", fitPT, 2., 140., 4);
  //TF1* fitpol0 = new TF1("fitpol0", "pol0(0)", 2., 140.);
  TF1* fitpol0 = new TF1("fitpol0", "[0]", 2., 140.);
  //TF1* fitPTfunc = new TF1("fitPTfunc", "[0]*TMath::Erf([1]*x-[2])+[3]", 2., 140.);
  //TLegend* tl = SetLegend(0.57, 0.2, 0.77, 0.55);
  TLegend* tl = SetLegend(0.57, 0.25, 0.77, 0.55);
  for(int ihist = 0; ihist < N_thr; ihist++){ 
     histo[ihist]->SetMarkerColor(Ncolor[ihist]);//blue
     histo[ihist]->SetMarkerStyle(Nstyle[ihist]);
     histo[ihist]->SetMarkerSize(3);
     histo[ihist]->SetLineColor(Ncolor[ihist]); // blue
     histo[ihist]->SetLineWidth(4); 

     Double_t xmin = cutHLT[ihist];
     //Double_t xmin = 14.;
     histo[ihist] -> Fit(fitpol0,"R","", xmin, 140.);
     A0 = fitpol0->GetParameter(0);
     Double_t dA0 = fitpol0->GetParError(0);
     fitPTfunc -> SetParameters(0.43, 0.55, 3.5, A0);
     if(Iregion == 0)fitPTfunc -> SetParameters(0.45, 0.45, 3.7, A0);//overlap
     if(Iregion == 2)fitPTfunc -> SetParameters(0.2, 0.3, 2., A0);//high
     fitPTfunc -> SetParLimits(3, 10., -10.);
     fitPTfunc -> SetLineColor(Ncolor[ihist]);
     fitPTfunc -> SetLineWidth(4);
     histo[ihist] -> Fit(fitPTfunc,"R");
     if(ihist == 0) {histo[ihist] -> Draw("AP");}
     else{histo[ihist] -> Draw("P");};
     line[ihist]->SetLineColor(Ncolor[ihist]);
     line[ihist]->SetLineWidth(4);
     line[ihist]->Draw("same");
     cout << "plateau A0 = " << A0 << endl;
/*
     if(Iregion == 1) // golden
        {tl->AddEntry(histo[ihist], Form("CSCTF P_{T} #geq %4.1f GeV/c with 50%% at %4.1f GeV/c", cutL1[ihist], cutL150[ihist]), "pl");}
     else 
        {tl->AddEntry(histo[ihist], Form("CSCTF P_{T} #geq %4.1f GeV/c", cutL1[ihist]), "pl");}
*/
  //tl->AddEntry(histo[ihist], Form("CSCTF P_{T} #geq %4.1f GeV/c", cutL1[ihist]), "pl");
  //tl->AddEntry(histo[ihist], Form("CSCTF P_{T} #geq %4.1f GeV/c plateau at %4.2f", cutL1[ihist], A0), "pl");
  tl->AddEntry(histo[ihist], Form("CSCTF P_{T} #geq %4.1f GeV/c", cutL1[ihist]), "pl");
  tl->AddEntry(histo[ihist], Form("plateau at %4.2f #pm %4.2f", A0, dA0), "");
  }
  tl -> Draw("same");

  // Title
  PrintIt(Eff_PT_golden, titleCanvas);

  TLatex *latex = new TLatex();
  latex->SetTextSize(0.04);
  latex->SetTextColor(2);//red
  latex->SetNDC();
  //latex->DrawLatex(0.45,0.66,"CMS Preliminary 2010 (7 TeV)");
  //latex->DrawLatex(0.50,0.66,titlePrel);
  //latex->DrawLatex(0.49,0.64,titlePrel);
  latex->DrawLatex(0.59,0.64,titlePrel1);
  latex->DrawLatex(0.59,0.59,titlePrel2);
  Eff_PT_golden->Print("plots/"+gifname+".png");
}
////////////////////////////////////////////////
void L1CSCTF_tightRES_GOLDEN_PREL2011::fillEffEta(TGraphAsymmErrors* histo[], 
                                        TString titleCanvas, TString titlePrel, TString titleX, TString gifname){
  TCanvas* Eff_ETA_golden = new TCanvas("Eff_ETA_golden", "", 0, 0, 1900, 1200);
  //TCanvas* Eff_ETA_golden = new TCanvas("Eff_ETA_golden", "", 0, 0, 1000, 600);
  // draw eff: 3 GeV 
  histo[0]->GetYaxis() -> SetRangeUser(0., 1.05);
  histo[0]->GetXaxis()->SetTitle(titleX);
  //histo_3->GetXaxis()->CenterTitle();
  histo[0]->GetXaxis()->SetTitleSize(0.04);
  histo[0]->GetXaxis()->SetTitleOffset(1.2);
  histo[0]->GetYaxis()->SetTitle("Threshold Efficiency");
  histo[0]->GetYaxis()->SetTitleSize(0.04);
  histo[0]->GetYaxis()->SetTitleOffset(1.0);

  //TLegend* tl = SetLegend(0.3, 0.15, 0.59, 0.35);
  TLegend* tl = SetLegend(0.3, 0.19, 0.59, 0.35);
  for(int ihist = 0; ihist < N_thr; ihist++){
     histo[ihist]->SetMarkerColor(Ncolor[ihist]);//blue
     histo[ihist]->SetMarkerStyle(Nstyle[ihist]);
     histo[ihist]->SetMarkerSize(3);
     histo[ihist]->SetLineColor(Ncolor[ihist]); // blue
     histo[ihist]->SetLineWidth(4);
     if(ihist == 0) {histo[ihist] -> Draw("AP");}
     else{histo[ihist] -> Draw("P");};
     tl->AddEntry(histo[ihist], Form("CSCTF P_{T} #geq %4.1f GeV/c with HLT P_{T} #geq %4.1f GeV/c", cutL1[ihist], cutHLT[ihist]), "pl");
  }
  tl -> Draw("same");

  // Title
  PrintIt(Eff_ETA_golden, titleCanvas);

  TLatex *latex = new TLatex();
  latex->SetTextSize(0.04);
  latex->SetTextColor(2);//red
  latex->SetNDC();
  latex->DrawLatex(0.30,0.39,titlePrel);
  Eff_ETA_golden->Print("plots/"+gifname+".png");
}

Double_t fitPT(Double_t* x, Double_t* par){


   //Double_t eff = par[0]*(TMath::Erf(par[1]*x[0]-par[2])) + par[3];
   Double_t eff = par[0]*(TMath::Erf(par[1]*x[0]-par[2]) - 1.) + par[3];
   //cout << "fitPT: A0 = " << A0 << endl;
   return eff;
}

