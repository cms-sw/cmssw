#!/usr/bin/env python

from CondCore.Utiltities.payloadInspectorTemplate import *
import string, os, sys

def getClasses() :
    ret = []
    lines = ( line for line in file('src/plugin.cc') if line[0:3]=='REG')
    for line in lines:
        ret.append(line[line.find(',')+1:line.find(')')])
    return ret

def generateBuildFile(package,classes) :
    f = file('plugins/BuildFile','w')
    f.seek(0,2)
    s = string.Template(buildfileTemplate)
    for classname in classes:
        f.write(s.substitute(_PACKAGE_=package, _CLASS_NAME_=classname))

def generateWrapper(package,classes) :
    s = string.Template(wrapperTemplate)
    for classname in classes:
        f = file('plugins/'+classname+'PyWrapper.cc','w')
        f.write(s.substitute(_PACKAGE_=package, _CLASS_NAME_=classname, _HEADER_FILE_=classname))
        f.close()


if __name__ == "__main__":
    classes=getClasses()
    generateBuildFile(package,classes)
    generateWrapper(package,classes)

               
